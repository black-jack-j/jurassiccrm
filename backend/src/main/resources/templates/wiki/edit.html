<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<script type="text/javascript" th:src="@{/js/jquery-3.3.1.js}"></script>
<head>
    <meta charset="UTF-8">
    <title>Jurassic Park Wiki</title>
</head>


<div th:insert="fragments/header-fragment :: dependencies"></div>
<script th:inline="javascript">
    function resetImage(){
        let pageName = [[${wiki.title}]];
        let deletionURL = "http://localhost:8080/wiki/deleteImage?pageName=";
        deletionURL += pageName
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", deletionURL, false );
        xmlHttp.send( null );
        alert(xmlHttp.responseText+"Удалено")
        document.location.reload()
    }
</script>

<div class="ui segment" style="width: 500px;">
    <a href="home.html" th:href="@{/wiki}">Home</a>

    <br/>
    <div th:with="img1=${wiki.image}">
        <form th:if="${img1.isEmpty() == true}" th:object="${wiki}" enctype="multipart/form-data" method="post" th:action="@{/wiki/editWiki1}">
            <input type="hidden" th:field="*{id}">
            <h3>Title:</h3>
            <input type="text" th:field="*{title}">
            <br/>
            <input type="file" th:field="*{image}">
            <br/>
            <textarea th:field="*{text}"></textarea>
            <br/>
            <table>
                <tr>
                    <th>Выберите связанные страницы:</th>
                </tr>
                <tr th:each="title : ${allTitles}">
                    <td>
                        <p th:text="${title}"> Some dino</p>
                    </td>
                    <td>
                        &nbsp;<input type="checkbox" name="related" th:value="${title}" th:field="*{relatedPages}">
                    </td>
                </tr>
            </table>
            <input type="submit">
        </form>

        <form th:if="${img1.isEmpty() == false}" th:object="${wiki}" enctype="multipart/form-data" method="post" th:action="@{/wiki/editWiki2}">
            <input type="hidden" th:field="*{id}">
            <h3>Title:</h3>
            <input type="text" th:field="*{title}">
            <br/>
            <img th:field="*{image}" id="dino_img" alt="There is no image yet" src="data:image/png;base64,{}" th:src="@{'data:image/png;base64,' + *{image}}" style="width: 300px"/>
            <input type="button" onclick="resetImage()" value="Удалить"/>
            <br/>

            <textarea th:field="*{text}"></textarea>
            <br/>


            <table>
                <tr>
                    <th>Выберите связанные страницы:</th>
                </tr>
                <tr th:each="title : ${allTitles}">
                    <td>
                        <p th:text="${title}"> Some dino</p>
                    </td>
                    <td>
                        &nbsp;<input type="checkbox" name="related" th:value="${title}" th:field="*{relatedPages}">
                    </td>
                </tr>
            </table>
            <input type="submit">
        </form>
    </div>



</div>

</body>

</html>